import { SecretError } from './secret_error.js';
import { AmplifyFault, AmplifyUserError } from '@aws-amplify/platform-core';
import { SSMServiceException } from '@aws-sdk/client-ssm';
/**
 * Handles errors and translate them to AmplifyUserError or AmplifyFaults
 * To be used exclusively by the amplify cli
 */
export class SSMSecretClientWithAmplifyErrorHandling {
    secretClient;
    /**
     * wraps the secretClient with Amplify CLI specific error handling
     */
    constructor(secretClient) {
        this.secretClient = secretClient;
    }
    getSecret = async (backendIdentifier, secretIdentifier) => {
        try {
            return await this.secretClient.getSecret(backendIdentifier, secretIdentifier);
        }
        catch (e) {
            throw this.translateToAmplifyError(e, 'Get', secretIdentifier);
        }
    };
    listSecrets = async (backendIdentifier) => {
        try {
            return await this.secretClient.listSecrets(backendIdentifier);
        }
        catch (e) {
            throw this.translateToAmplifyError(e, 'List');
        }
    };
    setSecret = async (backendIdentifier, secretName, secretValue) => {
        try {
            return await this.secretClient.setSecret(backendIdentifier, secretName, secretValue);
        }
        catch (e) {
            throw this.translateToAmplifyError(e, 'Set');
        }
    };
    removeSecret = async (backendIdentifier, secretName) => {
        try {
            return await this.secretClient.removeSecret(backendIdentifier, secretName);
        }
        catch (e) {
            throw this.translateToAmplifyError(e, 'Remove', { name: secretName });
        }
    };
    translateToAmplifyError = (error, apiName, secretIdentifier) => {
        if (error instanceof SecretError && error.cause) {
            if ([
                'UnrecognizedClientException',
                'AccessDeniedException',
                'NotAuthorized',
                'ExpiredTokenException',
                'ExpiredToken',
                'CredentialsProviderError',
                'IncompleteSignatureException',
                'InvalidSignatureException',
            ].includes(error.cause.name)) {
                return new AmplifyUserError('SSMCredentialsError', {
                    message: `Failed to ${apiName.toLowerCase()} secrets. ${error.cause.name}: ${error.cause?.message}`,
                    resolution: 'Make sure your AWS credentials are set up correctly, refreshed and have necessary permissions to call SSM service',
                });
            }
            if (error.cause.message.includes('connect ENOMEM')) {
                return new AmplifyUserError('InsufficientMemorySpaceError', {
                    message: `Failed to ${apiName.toLowerCase()} secrets. ${error.cause.name}: ${error.cause?.message}`,
                    resolution: 'There appears to be insufficient memory on your system to finish. Close other applications or restart your system and try again.',
                });
            }
            if (error.cause.name === 'ParameterNotFound' &&
                (apiName === 'Get' || apiName === 'Remove') &&
                secretIdentifier) {
                return new AmplifyUserError('SSMParameterNotFoundError', {
                    message: `Failed to ${apiName.toLowerCase()} ${secretIdentifier.name} secret. ${error.cause.name}: ${error.cause?.message}`,
                    resolution: `Make sure that ${secretIdentifier.name} has been set. See https://docs.amplify.aws/react/deploy-and-host/fullstack-branching/secrets-and-vars/.`,
                });
            }
            let downstreamException = error;
            if (!(error.cause instanceof SSMServiceException) &&
                error.cause instanceof Error) {
                downstreamException = error.cause;
            }
            throw new AmplifyFault(`${apiName}SecretsFailedFault`, {
                message: `Failed to ${apiName.toLowerCase()} secrets. ${error.cause.name}: ${error.cause?.message}`,
            }, downstreamException);
        }
        return error;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3NtX3NlY3JldF93aXRoX2FtcGxpZnlfZXJyb3JfaGFuZGxpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvc3NtX3NlY3JldF93aXRoX2FtcGxpZnlfZXJyb3JfaGFuZGxpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0EsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUUxRDs7O0dBR0c7QUFDSCxNQUFNLE9BQU8sdUNBQXVDO0lBSXJCO0lBSDdCOztPQUVHO0lBQ0gsWUFBNkIsWUFBMEI7UUFBMUIsaUJBQVksR0FBWixZQUFZLENBQWM7SUFBRyxDQUFDO0lBRTNELFNBQVMsR0FBRyxLQUFLLEVBQ2YsaUJBQTRDLEVBQzVDLGdCQUFrQyxFQUNqQixFQUFFO1FBQ25CLElBQUk7WUFDRixPQUFPLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQ3RDLGlCQUFpQixFQUNqQixnQkFBZ0IsQ0FDakIsQ0FBQztTQUNIO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixNQUFNLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixDQUFDLENBQUM7U0FDaEU7SUFDSCxDQUFDLENBQUM7SUFFRixXQUFXLEdBQUcsS0FBSyxFQUNqQixpQkFBNEMsRUFDakIsRUFBRTtRQUM3QixJQUFJO1lBQ0YsT0FBTyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUM7U0FDL0Q7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUMvQztJQUNILENBQUMsQ0FBQztJQUVG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WUFDRCxNQUFNLElBQUksWUFBWSxDQUNwQixHQUFHLE9BQU8sb0JBQW9CLEVBQzlCO2dCQUNFLE9BQU8sRUFBRSxhQUFhLE9BQU8sQ0FBQyxXQUFXLEVBQUUsYUFDekMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUNkLEtBQUssS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUU7YUFDNUIsRUFDRCxtQkFBbUIsQ0FDcEIsQ0FBQztTQUNIO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDLENBQUM7Q0FDSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcElkLCBCYWNrZW5kSWRlbnRpZmllciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuaW1wb3J0IHtcbiAgU2VjcmV0LFxuICBTZWNyZXRDbGllbnQsXG4gIFNlY3JldElkZW50aWZpZXIsXG4gIFNlY3JldExpc3RJdGVtLFxufSBmcm9tICcuL3NlY3JldC5qcyc7XG5pbXBvcnQgeyBTZWNyZXRFcnJvciB9IGZyb20gJy4vc2VjcmV0X2Vycm9yLmpzJztcbmltcG9ydCB7IEFtcGxpZnlGYXVsdCwgQW1wbGlmeVVzZXJFcnJvciB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbGF0Zm9ybS1jb3JlJztcbmltcG9ydCB7IFNTTVNlcnZpY2VFeGNlcHRpb24gfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc3NtJztcblxuLyoqXG4gKiBIYW5kbGVzIGVycm9ycyBhbmQgdHJhbnNsYXRlIHRoZW0gdG8gQW1wbGlmeVVzZXJFcnJvciBvciBBbXBsaWZ5RmF1bHRzXG4gKiBUbyBiZSB1c2VkIGV4Y2x1c2l2ZWx5IGJ5IHRoZSBhbXBsaWZ5IGNsaVxuICovXG5leHBvcnQgY2xhc3MgU1NNU2VjcmV0Q2xpZW50V2l0aEFtcGxpZnlFcnJvckhhbmRsaW5nIGltcGxlbWVudHMgU2VjcmV0Q2xpZW50IHtcbiAgLyoqXG4gICAqIHdyYXBzIHRoZSBzZWNyZXRDbGllbnQgd2l0aCBBbXBsaWZ5IENMSSBzcGVjaWZpYyBlcnJvciBoYW5kbGluZ1xuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBzZWNyZXRDbGllbnQ6IFNlY3JldENsaWVudCkge31cblxuICBnZXRTZWNyZXQgPSBhc3luYyAoXG4gICAgYmFja2VuZElkZW50aWZpZXI6IEJhY2tlbmRJZGVudGlmaWVyIHwgQXBwSWQsXG4gICAgc2VjcmV0SWRlbnRpZmllcjogU2VjcmV0SWRlbnRpZmllclxuICApOiBQcm9taXNlPFNlY3JldD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZWNyZXRDbGllbnQuZ2V0U2VjcmV0KFxuICAgICAgICBiYWNrZW5kSWRlbnRpZmllcixcbiAgICAgICAgc2VjcmV0SWRlbnRpZmllclxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyB0aGlzLnRyYW5zbGF0ZVRvQW1wbGlmeUVycm9yKGUsICdHZXQnLCBzZWNyZXRJZGVudGlmaWVyKTtcbiAgICB9XG4gIH07XG5cbiAgbGlzdFNlY3JldHMgPSBhc3luYyAoXG4gICAgYmFja2VuZElkZW50aWZpZXI6IEJhY2tlbmRJZGVudGlmaWVyIHwgQXBwSWRcbiAgKTogUHJvbWlzZTxTZWNyZXRMaXN0SXRlbVtdPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlY3JldENsaWVudC5saXN0U2VjcmV0cyhiYWNrZW5kSWRlbnRpZmllcik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgdGhpcy50cmFuc2xhdGVUb0FtcGxpZnlFcnJvcihlLCAnTGlzdCcpO1xuICAgIH1cbiAgfTtcblxuICBzZXRTZWNyZXQgPSBhc3luYyAoXG4gICAgYmFja2VuZElkZW50aWZpZXI6IEJhY2tlbmRJZGVudGlmaWVyIHwgQXBwSWQsXG4gICAgc2VjcmV0TmFtZTogc3RyaW5nLFxuICAgIHNlY3JldFZhbHVlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTZWNyZXRJZGVudGlmaWVyPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlY3JldENsaWVudC5zZXRTZWNyZXQoXG4gICAgICAgIGJhY2tlbmRJZGVudGlmaWVyLFxuICAgICAgICBzZWNyZXROYW1lLFxuICAgICAgICBzZWNyZXRWYWx1ZVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aHJvdyB0aGlzLnRyYW5zbGF0ZVRvQW1wbGlmeUVycm9yKGUsICdTZXQnKTtcbiAgICB9XG4gIH07XG5cbiAgcmVtb3ZlU2VjcmV0ID0gYXN5bmMgKFxuICAgIGJhY2tlbmRJZGVudGlmaWVyOiBCYWNrZW5kSWRlbnRpZmllciB8IEFwcElkLFxuICAgIHNlY3JldE5hbWU6IHN0cmluZ1xuICApOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VjcmV0Q2xpZW50LnJlbW92ZVNlY3JldChcbiAgICAgICAgYmFja2VuZElkZW50aWZpZXIsXG4gICAgICAgIHNlY3JldE5hbWVcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgdGhpcy50cmFuc2xhdGVUb0FtcGxpZnlFcnJvcihlLCAnUmVtb3ZlJywgeyBuYW1lOiBzZWNyZXROYW1lIH0pO1xuICAgIH1cbiAgfTtcblxuICBwcml2YXRlIHRyYW5zbGF0ZVRvQW1wbGlmeUVycm9yID0gKFxuICAgIGVycm9yOiB1bmtub3duLFxuICAgIGFwaU5hbWU6IHN0cmluZyxcbiAgICBzZWNyZXRJZGVudGlmaWVyPzogU2VjcmV0SWRlbnRpZmllclxuICApID0+IHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTZWNyZXRFcnJvciAmJiBlcnJvci5jYXVzZSkge1xuICAgICAgaWYgKFxuICAgICAgICBbXG4gICAgICAgICAgJ1VucmVjb2duaXplZENsaWVudEV4Y2VwdGlvbicsXG4gICAgICAgICAgJ0FjY2Vzc0RlbmllZEV4Y2VwdGlvbicsXG4gICAgICAgICAgJ05vdEF1dGhvcml6ZWQnLFxuICAgICAgICAgICdFeHBpcmVkVG9rZW5FeGNlcHRpb24nLFxuICAgICAgICAgICdFeHBpcmVkVG9rZW4nLFxuICAgICAgICAgICdDcmVkZW50aWFsc1Byb3ZpZGVyRXJyb3InLFxuICAgICAgICAgICdJbmNvbXBsZXRlU2lnbmF0dXJlRXhjZXB0aW9uJyxcbiAgICAgICAgICAnSW52YWxpZFNpZ25hdHVyZUV4Y2VwdGlvbicsXG4gICAgICAgIF0uaW5jbHVkZXMoZXJyb3IuY2F1c2UubmFtZSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ1NTTUNyZWRlbnRpYWxzRXJyb3InLCB7XG4gICAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byAke2FwaU5hbWUudG9Mb3dlckNhc2UoKX0gc2VjcmV0cy4gJHtcbiAgICAgICAgICAgIGVycm9yLmNhdXNlLm5hbWVcbiAgICAgICAgICB9OiAke2Vycm9yLmNhdXNlPy5tZXNzYWdlfWAsXG4gICAgICAgICAgcmVzb2x1dGlvbjpcbiAgICAgICAgICAgICdNYWtlIHN1cmUgeW91ciBBV1MgY3JlZGVudGlhbHMgYXJlIHNldCB1cCBjb3JyZWN0bHksIHJlZnJlc2hlZCBhbmQgaGF2ZSBuZWNlc3NhcnkgcGVybWlzc2lvbnMgdG8gY2FsbCBTU00gc2VydmljZScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGVycm9yLmNhdXNlLm1lc3NhZ2UuaW5jbHVkZXMoJ2Nvbm5lY3QgRU5PTUVNJykpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnN1ZmZpY2llbnRNZW1vcnlTcGFjZUVycm9yJywge1xuICAgICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gJHthcGlOYW1lLnRvTG93ZXJDYXNlKCl9IHNlY3JldHMuICR7XG4gICAgICAgICAgICBlcnJvci5jYXVzZS5uYW1lXG4gICAgICAgICAgfTogJHtlcnJvci5jYXVzZT8ubWVzc2FnZX1gLFxuICAgICAgICAgIHJlc29sdXRpb246XG4gICAgICAgICAgICAnVGhlcmUgYXBwZWFycyB0byBiZSBpbnN1ZmZpY2llbnQgbWVtb3J5IG9uIHlvdXIgc3lzdGVtIHRvIGZpbmlzaC4gQ2xvc2Ugb3RoZXIgYXBwbGljYXRpb25zIG9yIHJlc3RhcnQgeW91ciBzeXN0ZW0gYW5kIHRyeSBhZ2Fpbi4nLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgZXJyb3IuY2F1c2UubmFtZSA9PT0gJ1BhcmFtZXRlck5vdEZvdW5kJyAmJlxuICAgICAgICAoYXBpTmFtZSA9PT0gJ0dldCcgfHwgYXBpTmFtZSA9PT0gJ1JlbW92ZScpICYmXG4gICAgICAgIHNlY3JldElkZW50aWZpZXJcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ1NTTVBhcmFtZXRlck5vdEZvdW5kRXJyb3InLCB7XG4gICAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byAke2FwaU5hbWUudG9Mb3dlckNhc2UoKX0gJHtcbiAgICAgICAgICAgIHNlY3JldElkZW50aWZpZXIubmFtZVxuICAgICAgICAgIH0gc2VjcmV0LiAke2Vycm9yLmNhdXNlLm5hbWV9OiAke2Vycm9yLmNhdXNlPy5tZXNzYWdlfWAsXG4gICAgICAgICAgcmVzb2x1dGlvbjogYE1ha2Ugc3VyZSB0aGF0ICR7c2VjcmV0SWRlbnRpZmllci5uYW1lfSBoYXMgYmVlbiBzZXQuIFNlZSBodHRwczovL2RvY3MuYW1wbGlmeS5hd3MvcmVhY3QvZGVwbG95LWFuZC1ob3N0L2Z1bGxzdGFjay1icmFuY2hpbmcvc2VjcmV0cy1hbmQtdmFycy8uYCxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBsZXQgZG93bnN0cmVhbUV4Y2VwdGlvbjogRXJyb3IgPSBlcnJvcjtcbiAgICAgIGlmIChcbiAgICAgICAgIShlcnJvci5jYXVzZSBpbnN0YW5jZW9mIFNTTVNlcnZpY2VFeGNlcHRpb24pICYmXG4gICAgICAgIGVycm9yLmNhdXNlIGluc3RhbmNlb2YgRXJyb3JcbiAgICAgICkge1xuICAgICAgICBkb3duc3RyZWFtRXhjZXB0aW9uID0gZXJyb3IuY2F1c2U7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgQW1wbGlmeUZhdWx0KFxuICAgICAgICBgJHthcGlOYW1lfVNlY3JldHNGYWlsZWRGYXVsdGAsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvICR7YXBpTmFtZS50b0xvd2VyQ2FzZSgpfSBzZWNyZXRzLiAke1xuICAgICAgICAgICAgZXJyb3IuY2F1c2UubmFtZVxuICAgICAgICAgIH06ICR7ZXJyb3IuY2F1c2U/Lm1lc3NhZ2V9YCxcbiAgICAgICAgfSxcbiAgICAgICAgZG93bnN0cmVhbUV4Y2VwdGlvblxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9yO1xuICB9O1xufVxuIl19